<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies!</title>
    <script>
        function reverseString(s) {
            return s.split("").reverse().join("");
        }

        window.onload = function () {
            const xhr = new XMLHttpRequest()
            xhr.onload = function () {
                const bodyElement = document.querySelector("body")
                
                if (xhr.status == 200) {
		            /* Part 2: Build the HTML elements here and append them to the body */ 
                    //bodyElement.append(reverseString(xhr.responseText))                  
        
                    // parse JSON data into JavaScript object and create html elements
                    let movies = JSON.parse(xhr.responseText)
                    
                    movies.forEach(movie => {
                        let articleElement = document.createElement("article")
                        
                        let imgElement = document.createElement("img")
                        imgElement.src = movie.Poster
                        articleElement.append(imgElement)

                        let titleElement = document.createElement("h1")
                        titleElement.innerText = movie.Title
                        articleElement.append(titleElement)

                        let firstParagraphElement = document.createElement("p")
                        let runtimeElement = document.createElement("span")
                        runtimeElement.innerText = "Runtime " + Math.trunc(movie.Runtime/60) + "h " + movie.Runtime%60 + "m"
                        let bulletPointElement = document.createElement("span")
                        bulletPointElement.innerText = "\u2022"
                        let releaseDateElement = document.createElement("span")
                        let releaseDate = new Date(movie.Released);
                        releaseDateElement.innerText = "Released on " + releaseDate.toLocaleDateString("en-US")
                        firstParagraphElement.append(runtimeElement, bulletPointElement, releaseDateElement)
                        articleElement.append(firstParagraphElement)

                        let secondParagraphElement = document.createElement("p")
                        movie.Genres.forEach(genre => {
                            let spanElement = document.createElement("span")
                            spanElement.classList.add("genre")
                            spanElement.innerText = genre
                            secondParagraphElement.append(spanElement)
                        })
                        articleElement.append(secondParagraphElement)

                        let thirdParagraphElement = document.createElement("p")
                        thirdParagraphElement.innerText = movie.Plot
                        articleElement.append(thirdParagraphElement)

                        let directorElement = document.createElement("h2")
                        directorElement.innerText = "Directors"

                        let firstUnorderedListElement = document.createElement("ul")
                        movie.Directors.forEach(director => {
                            let listItem = document.createElement("li")
                            listItem.innerText = director
                            firstUnorderedListElement.append(listItem)
                        })
                        articleElement.append(directorElement, firstUnorderedListElement)

                        let writerElement = document.createElement("h2")
                        writerElement.innerText = "Writers"

                        let secondUnorderedListElement = document.createElement("ul")
                        movie.Writers.forEach(writer => {
                            let listItem = document.createElement("li")
                            listItem.innerText = writer
                            secondUnorderedListElement.append(listItem)
                        })
                        articleElement.append(writerElement, secondUnorderedListElement)

                        let actorElement = document.createElement("h2")
                        actorElement.innerText = "Actors"

                        let thirdUnorderedListElement = document.createElement("ul")
                        movie.Actors.forEach(actor => {
                            let listItem = document.createElement("li")
                            listItem.innerText = actor
                            thirdUnorderedListElement.append(listItem)
                        })
                        articleElement.append(actorElement, thirdUnorderedListElement)


                        let h2Element = document.createElement("h2")

                        let unorderedListElement = document.createElement("ul")

                        bodyElement.append(articleElement)
                    });
                    
                } else {
                    bodyElement.append("Daten konnten nicht geladen werden, Status " + xhr.status + " - " + xhr.statusText)
                }
            }
            xhr.open("GET", "/movies")
            xhr.send()
        }
    </script>

</head>

<body>
</body>

</html>
