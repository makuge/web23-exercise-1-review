<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies!</title>
    <script>
        window.onload = function () {
            const xhr = new XMLHttpRequest();
            xhr.onload = function () {
                const movieData = JSON.parse(xhr.responseText);

                const movieContainer = document.getElementById("movieContainer");

                movieData.forEach(function (movieData) {
                    const movieArticle = document.createElement("article");
                    movieArticle.classList.add("movie");

                    const posterImg = document.createElement("img");
                    posterImg.src = movieData.Poster;
                    posterImg.alt = movieData.Title + " Poster";
                    posterImg.classList.add("poster");
                    movieArticle.appendChild(posterImg);

                    const titleHeader = document.createElement("h1");
                    titleHeader.textContent = movieData.Title;
                    movieArticle.appendChild(titleHeader);

                    const basicInfoParagraph = document.createElement("p");
                    const runTimeSpan = document.createElement("span")
                    const hours = Math.trunc(movieData.Runtime / 60);
                    const minutes = movieData.Runtime % 60;
                    const formattedRuntime = "Runtime: " + hours + "h " + minutes + "m ";
                    runTimeSpan.textContent = formattedRuntime;
                    const bulletSpan = document.createElement("span");
                    bulletSpan.textContent = "\u2022 ";
                    const dateSpan = document.createElement("span");
                    isoDate = movieData.Released;
                    const dateObj = new Date(isoDate);
                    const day = dateObj.getDate().toString().padStart(2, '0');
                    const month = (dateObj.getMonth() + 1).toString().padStart(2, '0'); // Month is zero-based, so add 1
                    const year = dateObj.getFullYear();
                    const formattedDate = isoDate.replace(/(\d{4})-(\d{1,2})-(\d{1,2})/, (match, year, month, day) => `${parseInt(month, 10)}/${parseInt(day, 10)}/${year}`);
                    dateText = "Released on: " + formattedDate;
                    dateSpan.textContent = dateText;
                    basicInfoParagraph.appendChild(runTimeSpan)
                    basicInfoParagraph.appendChild(bulletSpan)
                    basicInfoParagraph.appendChild(dateSpan)
                    movieArticle.appendChild(basicInfoParagraph);
                    const genreParagraph = document.createElement("p"); // Create a paragraph element

                    // Iterate over the genres array
                    movieData.Genres.forEach(genre => {
                        // Create a <span> element for each genre
                        const genreSpan = document.createElement("span");
                        genreSpan.textContent = genre + " ";
                        genreSpan.classList.add("genre"); // Add the class "genre" to the span element

                        // Append the genre <span> element to the paragraph <p>
                        genreParagraph.appendChild(genreSpan);
                    });

                    // Append the genre paragraph to the movie article
                    movieArticle.appendChild(genreParagraph);


                    const plotParagraph = document.createElement("p");
                    plotParagraph.textContent = movieData.Plot;
                    movieArticle.appendChild(plotParagraph);

                    const directorsHeader = document.createElement("h2");
                    directorsHeader.textContent = "Directors";
                    movieArticle.appendChild(directorsHeader);

                    const directorsList = document.createElement("ul");
                    movieData.Directors.forEach(function (director) {
                        const directorItem = document.createElement("li");
                        directorItem.textContent = director;
                        directorsList.appendChild(directorItem);
                    });
                    movieArticle.appendChild(directorsList);

                    const writersHeader = document.createElement("h2");
                    writersHeader.textContent = "Writers";
                    movieArticle.appendChild(writersHeader);

                    const writersList = document.createElement("ul");
                    movieData.Writers.forEach(function (writer) {
                        const writerItem = document.createElement("li");
                        writerItem.textContent = writer;
                        writersList.appendChild(writerItem);
                    });
                    movieArticle.appendChild(writersList);

                    const actorsHeader = document.createElement("h2");
                    actorsHeader.textContent = "Actors";
                    movieArticle.appendChild(actorsHeader);

                    const actorsList = document.createElement("ul");
                    movieData.Actors.forEach(function (actor) {
                        const actorItem = document.createElement("li");
                        actorItem.textContent = actor;
                        actorsList.appendChild(actorItem);
                    });
                    movieArticle.appendChild(actorsList);

                    movieContainer.appendChild(movieArticle);
                });
            };
            xhr.open("GET", "/movies");
            xhr.send();
        };


    </script>

</head>

<body>
    <div id="movieContainer"></div>
</body>

</html>